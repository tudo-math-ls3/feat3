<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FEAT: Description of the mesh optimization tools</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FEAT<span id="projectnumber">&#160;3</span>
   </div>
   <div id="projectbrief">Finite Element Analysis Toolbox</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('meshopt_design.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Description of the mesh optimization tools </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="basic_overview"></a>
Basic overview</h1>
<p >The Meshopt namespace contains all tools for mesh optimization (sometimes also called <em> mesh smoothing </em>). These two terms are used synonymously. The baseclass is <a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_mesh_quality_functional.html">FEAT::Meshopt::MeshQualityFunctional</a> and shall be used for illustrational purposes in this section.</p>
<p >A MeshQualityFunctional measures the quality of a mesh in some sense and can be used in conjuction with a (non-)linear solver to <em>optimize</em> the mesh by minimising the functional value. It always refers to exactly one mesh (through a <a class="el" href="class_f_e_a_t_1_1_geometry_1_1_root_mesh_node.html" title="Root mesh node class template.">FEAT::Geometry::RootMeshNode</a>), contains a pointer to it and can modify exactly this mesh and nothing more. The main use cases are:</p>
<ol type="1">
<li><p class="startli">The mesh is moving, where only the boundary movement is known (i.e. decoupled fluid-structure interactions, Navier Stokes with free capillary boundary etc.).</p>
<p class="startli">Then this movement has to be continued to the interiour of the computational domain. In finite element and math terminology: If the boundary movement is a function with "enough regularity", then it is the trace of a function on the whole domain and we can find one possible preimage by constructing an inverse trace operator.</p>
<p class="startli">The most simple example for this to solve </p><p class="formulaDsp">
\[ - \Delta u = 0 ~ \mathrm{in} ~ \Omega, u = u_D ~\mathrm{on}~ \partial \Omega \]
</p>
<p> with finite element tools on the FE space the transformation is from, where \( u_D \) are the new boundary coordinates. The solution then contains the new vertex coordinates in the interiour.</p>
<p class="startli">This is also called <em>Laplacian smoothing</em> and is nothing more than minimising the harmonic energy of the transformation which satisfies the appropriate boundary conditions. This is implemented in FEAT::Meshopt::LaplaceFunctional. The boundary coordinates \( u_D \) are then the trace of the FE function \( u \) on \( \partial \Omega \) and the solving of the above problem was the application of one possible inverse trace operator. The solution is also the minimizer of the harmonic energy on the space with the appropriate boundary values.</p>
</li>
<li><p class="startli">A given mesh is to be improved according to some quality measure.</p>
<p class="startli">This quality measure needs to be a functional defined in terms geometric quantities. There are some regularity assumptions that need to hold, i.e. we need to be able to compute the first order derivatives with regard to the mesh vertices.</p>
<p class="startli">One example is <em>r-adaptivity</em>, where mesh vertices are moved so that the mesh's cells are smaller in a region of interest (also called mesh condensation). This is implemented in the <a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_hyperelasticity_functional.html">FEAT::Meshopt::HyperelasticityFunctional</a> class, which makes use of the <a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_mesh_concentration_function.html" title="Class to compute a desired concentration for the mesh cell distribution.">FEAT::Meshopt::MeshConcentrationFunction</a> class for describing the desired cell size distribution over the domain. At the moment, this can be done by adding charts derived <a class="el" href="class_f_e_a_t_1_1_geometry_1_1_atlas_1_1_chart_base.html" title="Chart base-class.">FEAT::Geometry::Atlas::ChartBase</a> to the <a class="el" href="namespace_f_e_a_t_1_1_geometry_1_1_atlas.html" title="Atlas namespace.">FEAT::Geometry::Atlas</a> that is contained in the <a class="el" href="class_f_e_a_t_1_1_geometry_1_1_root_mesh_node.html" title="Root mesh node class template.">FEAT::Geometry::RootMeshNode</a> in the quality functional, and using those to describe surfaces or boundaries. The distance to those boundaries can then be used in the <a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_mesh_concentration_function.html" title="Class to compute a desired concentration for the mesh cell distribution.">FEAT::Meshopt::MeshConcentrationFunction</a> to govern the desired cell size distribution.</p>
</li>
<li><p class="startli">For a given mesh and an implicitly defined surface, mesh vertices/edges/faces are to be aligned to the surface</p>
<p class="startli">This is usually used in conjunction with a quality measure that makes sure the alignment does not lead to a deterioration of the mesh. This functionality is implemented i.e. in the class <a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_hyperelasticity_functional.html" title="Baseclass for a family of variational mesh optimization algorithms.">FEAT::Meshopt::HyperelasticityFunctional</a>. How well this works depends on the shape type (<a class="el" href="namespace_f_e_a_t_1_1_shape.html">FEAT::Shape</a>) of the mesh. Due to topological reasons, alignment to facets is possible for <a class="el" href="struct_f_e_a_t_1_1_shape_1_1_simplex.html" title="Simplex shape tag struct template.">FEAT::Shape::Simplex</a>, but not for <a class="el" href="struct_f_e_a_t_1_1_shape_1_1_hypercube.html" title="Hypercube shape tag struct template.">FEAT::Shape::Hypercube</a>, although alignment to mesh vertices is possible in that case.</p>
</li>
</ol>
<p >These use cases are in no way disjoint: There are cases of moving meshes with an implicitly defined surface, to which the mesh needs to be aligned and also condensated near the surface, all while ensuring that the mesh does not deteriorate.</p>
<h1><a class="anchor" id="workflow"></a>
Workflow</h1>
<p >It is recommended to use all classes derived from MeshQualityFunctional through their respective <em>control classes</em> from the <a class="el" href="namespace_f_e_a_t_1_1_control_1_1_meshopt.html" title="Control layer for mesh optimization.">FEAT::Control::Meshopt</a> namespace, namely <a class="el" href="class_f_e_a_t_1_1_control_1_1_meshopt_1_1_du_dv_functional_control.html" title="Control class for DuDvFunctionals.">FEAT::Control::Meshopt::DuDvFunctionalControl</a> and <a class="el" href="class_f_e_a_t_1_1_control_1_1_meshopt_1_1_hyperelasticity_functional_control.html" title="Control class for HyperelasticityFunctionals.">FEAT::Control::Meshopt::HyperelasticityFunctionalControl</a>. The easiest way to configure and use them is through configuration files which can be read at startup time to create <a class="el" href="class_f_e_a_t_1_1_property_map.html" title="A class organizing a tree of key-value pairs.">FEAT::PropertyMap</a> s, which can be used in the <a class="el" href="struct_f_e_a_t_1_1_control_1_1_meshopt_1_1_control_factory.html" title="Factory for MeshoptControl objects.">FEAT::Control::Meshopt::ControlFactory</a> to create these objects at runtime. Their basic interface is made available through a <a class="el" href="class_f_e_a_t_1_1_control_1_1_meshopt_1_1_meshopt_control_base.html" title="Base class for Meshopt control objects.">FEAT::Control::Meshopt::MeshoptControlBase</a> base class pointer and should be sufficient to access and use the underlying object. Examples of this can be found in the applications folder (i.e. meshopt_r_adapt-app, meshopt_boundary-app, meshopt_refinement-app), while the (more primitive) meshopt_hyperelasticity_resize-app uses the <a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_hyperelasticity_functional.html" title="Baseclass for a family of variational mesh optimization algorithms.">FEAT::Meshopt::HyperelasticityFunctional</a> directly. The solver used by these objects are created using the FEAT::Control::MeshoptSolverFactory and the <a class="el" href="struct_f_e_a_t_1_1_control_1_1_meshopt_1_1_meshopt_precond_factory.html" title="Factory class for specialized preconditioners.">FEAT::Control::Meshopt::MeshoptPrecondFactory</a>. Note that this makes heavy use of the classes from the <a class="el" href="namespace_f_e_a_t_1_1_control_1_1_domain.html" title="Domain control namespace.">FEAT::Control::Domain</a> namespace.</p>
<p >After creating a control object <code>meshopt_ctrl</code> from a Control::DomainControl, its <code>prepare()</code> function needs to be called before optimising the mesh by calling <code>meshopt_ctrl-&gt;optimize()</code>. One can write the current mesh coordinates to the object's buffer using meshopt_ctrl-&gt;mesh_to_buffer() and get a reference to the buffer by meshopt_ctrl-&gt;get_coords(). One can call <code>auto new_coords = meshopt_ctrl-&gt;get_coords().clone(LAFEM::CloneMode::Deep)</code> to obtain a deep copy of the mesh's vertex coordinates, manipulate them, and then call <code>meshopt_ctrl-&gt;prepare(old_coords)</code> to prepare the functional.</p>
<p >If we have a <a class="el" href="class_f_e_a_t_1_1_geometry_1_1_export_v_t_k.html" title="VTK exporter class template.">FEAT::Geometry::ExportVTK</a> object for writing the date to a .vtu file, we can simply call <code>meshopt_ctrl-&gt;add_to_vtk_exporter</code> to add the relevant data to it. Refer to the class documentation for details.</p>
<h1><a class="anchor" id="imp_classes"></a>
Implemented classes</h1>
<p >Currently there are two main classes of MeshQualityFunctionals:</p><ol type="1">
<li>Quadratic mesh quality functionals, for which a linear PDE problem is solved using finite elements. This only supports the computation of extension operators.<ul>
<li><a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_du_dv_functional.html" title="Mesh optimizer based on minimization of harmonic energy.">FEAT::Meshopt::DuDvFunctional</a></li>
</ul>
</li>
<li>Nonlinear functionals based on the polyconvex stored-energy functionals for hyperelastic materials, see <b>[Rum96]</b>. These support computation of extension operators, <em>r-adaptivity</em> and <em>mesh</em> alignment.<ul>
<li><a class="el" href="class_f_e_a_t_1_1_meshopt_1_1_hyperelasticity_functional.html" title="Baseclass for a family of variational mesh optimization algorithms.">FEAT::Meshopt::HyperelasticityFunctional</a></li>
</ul>
</li>
</ol>
<p >For more information on mesh optimization, refer to <b>[HR11]</b>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
